{%
#begin date
#end date
#checkboxes of who went on trip
#select location from drop down menu
#checked check boxes with all active sites in location appears, exclude cave rooms
#approve button, generates 1) field trip with location, begin date, end date 2)samplenamemasterlist entries with sites and field trip
%}
{% extends 'layouts/base.html' %}
{% block title %}Enter - {{ block.super }}{% endblock %}
{% block content %}
<form action="/new-fieldtrip/" method="POST">
  {% csrf_token %}
  <b>Trip Begin:</b>
  <input type="date" name="BeginFieldTrip">
  <br><br><br>
  <b>Trip End:</b>
  <input type="date" name="EndFieldTrip">
  <br>
  Field Trip Location:
  <select name="Location">
    <option value="unset">Pick a site</option>
    {% for entry in location_all %}
      <option value="{{entry.idlocation}}">{{entry.location}}</option>
      {% endfor %}
  </select>
  <br><br>
  <div id="Checkboxes" class=hidden>
  {% for entry in site_all %}
    <input type="checkbox" name="site" value="{{entry.site}}">{{entry.site}}<br>
  {% endfor %}
  </div>
  <br><br>
  <input type="submit" value="Submit">
</form>
  <script>
  $(function() {
    var $site = $('div#Checkboxes');
    var $loc = $('select[name="Location"]');

    $loc.change(function(){
      var val = $(this).val();
      if(val == "unset"){
        $site.addClass("hidden");
        return;
      }

      console.log(val + " selected");

      $.get("/api/locations/" + val, function(data){
        console.log(data);
        $site.empty();
        $.each(data["fk_Site_Location"], function(idx, val) {
          $site.append("<input type='checkbox' name='site' value='" + val.idsite + "'> "+ val.site +"<br>")
        });
        $site.removeClass("hidden");
      })
    })
  });
  </script>
{% endblock %}
